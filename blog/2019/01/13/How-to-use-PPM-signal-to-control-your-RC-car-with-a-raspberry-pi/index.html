<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-2788491084128109",
    enable_page_level_ads: true
  });
</script>




















  
  
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5">







<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-jar.ico?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-jar.ico?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-jar.ico?v=6.7.0">


  <link rel="mask-icon" href="/images/favicon-32x32-jar.ico?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="The RC car I use is a Tamiya 1/10 Mercedes-Benz Unimog 425 truck with the CC-01 (Cross Country) chassis. With a full-time 4WD system, front double wishbone, rear 4-link rigid suspension and RS-540 E-M">
<meta name="keywords" content="raspberry pi, PPM, RC car, control, PWM">
<meta property="og:type" content="article">
<meta property="og:title" content="How to use PPM signal to control your RC car with a raspberry pi">
<meta property="og:url" content="https://www.thingsjar.com/blog/2019/01/13/How-to-use-PPM-signal-to-control-your-RC-car-with-a-raspberry-pi/index.html">
<meta property="og:site_name" content="Thingsjar">
<meta property="og:description" content="The RC car I use is a Tamiya 1/10 Mercedes-Benz Unimog 425 truck with the CC-01 (Cross Country) chassis. With a full-time 4WD system, front double wishbone, rear 4-link rigid suspension and RS-540 E-M">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://github.com/thingsjar/thingsjar/blob/master/images/Bildschirmfoto%202019-01-10%20um%2022.37.23.png?raw=true">
<meta property="og:image" content="https://github.com/thingsjar/thingsjar/blob/master/images/Bildschirmfoto%202019-01-10%20um%2022.40.14.png?raw=true">
<meta property="og:updated_time" content="2019-01-13T19:10:48.439Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How to use PPM signal to control your RC car with a raspberry pi">
<meta name="twitter:description" content="The RC car I use is a Tamiya 1/10 Mercedes-Benz Unimog 425 truck with the CC-01 (Cross Country) chassis. With a full-time 4WD system, front double wishbone, rear 4-link rigid suspension and RS-540 E-M">
<meta name="twitter:image" content="https://github.com/thingsjar/thingsjar/blob/master/images/Bildschirmfoto%202019-01-10%20um%2022.37.23.png?raw=true">






  <link rel="canonical" href="https://www.thingsjar.com/blog/2019/01/13/How-to-use-PPM-signal-to-control-your-RC-car-with-a-raspberry-pi/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>How to use PPM signal to control your RC car with a raspberry pi | Thingsjar</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Thingsjar</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.thingsjar.com/blog/2019/01/13/How-to-use-PPM-signal-to-control-your-RC-car-with-a-raspberry-pi/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Thingsjar">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Thingsjar">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">How to use PPM signal to control your RC car with a raspberry pi

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-13 19:55:09 / Modified: 20:10:48" itemprop="dateCreated datePublished" datetime="2019-01-13T19:55:09+01:00">2019-01-13</time>
            

            
              

              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2019/01/13/How-to-use-PPM-signal-to-control-your-RC-car-with-a-raspberry-pi/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/blog/2019/01/13/How-to-use-PPM-signal-to-control-your-RC-car-with-a-raspberry-pi/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>The RC car I use is a Tamiya 1/10 Mercedes-Benz Unimog 425 truck with the CC-01 (Cross Country) chassis. With a full-time 4WD system, front double wishbone, rear 4-link rigid suspension and RS-540 E-Motor, it is a multi-purpose truck with excellent off-road performance. </p>
<p>If we want to control a elektric motor, the most common way is to use a PWM signal to control a ESC (Electronic speed control). There is a ESC coming included in the tamiya model, but the input signal is PPM signal instead of PWM.</p>
<p>So, what’s the difference betwen PPM and PWM? The RC transmitter normally has at least one channel for throttle and one for steering. The transmitter encode both signal channels in a single pulse and send it to receiver. This process is also called pulse-position modulation (PPM). The receiver decode the signal and send the throttle and steering signals to the RS-540 and the sterring servo motor separately .</p>
<p>How does the signal to control RS-540 look like? I used a USB Logic Analyzer to catch the PPM signal which is sent to RS-540.</p>
<p><img src="https://github.com/thingsjar/thingsjar/blob/master/images/Bildschirmfoto%202019-01-10%20um%2022.37.23.png?raw=true" alt="Bildschirmfoto 2019-01-10 um 22.37.23"></p>
<p>As you can see, it’s a pulse with repeated cycles. One cycle is about 20ms with 1-2ms high level. For example, 1.5ms is the neutral throttle position, 1ms is for the maximal forward speed and 2ms for the minimal reverse. To have a look direktly into the protocol, I measured the PPM signal as follows.</p>
<p><img src="https://github.com/thingsjar/thingsjar/blob/master/images/Bildschirmfoto%202019-01-10%20um%2022.40.14.png?raw=true" alt="Bildschirmfoto 2019-01-10 um 22.40.14"></p>
<p>Here are the data which i measured from my RC receiver when i put the throttle to neutral, max forward, max reverse position:</p>
<table>
<thead>
<tr>
<th>throttle pos.</th>
<th>high-level time</th>
<th>total cycle</th>
</tr>
</thead>
<tbody>
<tr>
<td>neutral</td>
<td>1.45ms</td>
<td>19.75ms</td>
</tr>
<tr>
<td>max. reverse</td>
<td>1.75ms</td>
<td>19.65ms</td>
</tr>
<tr>
<td>max. forward</td>
<td>1.15ms</td>
<td>19.55ms</td>
</tr>
</tbody>
</table>
<p>So if we generate a similar signal and send it into the ESC, the problem would be solved.</p>
<p>The first problem is, how to control time very precisely with an accuracy of 1-10us using a raspberry pi? I tried to use the time.sleep() function and it is not accurate enough. So i used the <strong>PIGPIO</strong> library. What do we have to do? Just install pigpio with the following command on the raspberry pi:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install pigpio python-pigpio python3-pigpio</span><br></pre></td></tr></table></figure>
<p>then use this cmd to start the pigpio daemon.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pigpiod</span><br></pre></td></tr></table></figure>
<p>if you used this cmd, you have to input this cmd again to start the pigpio daemon when you reboot your system. If you want to run pigpiod automatically on boot, you can use following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable pigpiod</span><br></pre></td></tr></table></figure>
<p>So the pigpiod launches the pigpio library as a daemon in the background and accepts commands from the pipe and socket interface. That’s why you can use another computer, which is connected to the same local network, or even via internet to read and write all GPIOs of your raspberry pi.</p>
<p>Of course, you also have to install pigpio library on your computer.</p>
<p>I used <code>pip install gpiozero pigpio</code> to install the library on my Mac OS. If you use other operating systems or python version, you can refer <a href="https://gpiozero.readthedocs.io/en/stable/remote_gpio.html" target="_blank" rel="noopener">here</a> for more information.</p>
<p>After that, I connected a LED light to GPIO 14 of my raspberry pi and used the following script to test if it really works:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pigpio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">pi=pigpio.pi(host=<span class="string">"192.168.2.117"</span>,) <span class="comment">#change here with your own IP of raspberry pi.</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> pi.connected:</span><br><span class="line">exit()</span><br><span class="line">pi.write(<span class="number">14</span>, <span class="number">0</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">pi.write(<span class="number">14</span>, <span class="number">1</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">pi.write(<span class="number">14</span>,<span class="number">0</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">pi.stop()</span><br></pre></td></tr></table></figure>
<p>The LED is blinking, so it worked!</p>
<p>here is the skript for the PPM module:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># PPM.py</span></span><br><span class="line"><span class="comment"># 2919-01-11</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pigpio</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span>:</span></span><br><span class="line"></span><br><span class="line">GAP=<span class="number">100</span></span><br><span class="line">WAVES=<span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, pi, gpio, channels=<span class="number">1</span>, frame_ms=<span class="number">19.65</span>)</span>:</span></span><br><span class="line">self.pi = pi</span><br><span class="line">self.gpio = gpio</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> frame_ms &lt; <span class="number">5</span>:</span><br><span class="line">frame_ms = <span class="number">5</span></span><br><span class="line">channels = <span class="number">2</span></span><br><span class="line"><span class="keyword">elif</span> frame_ms &gt; <span class="number">100</span>:</span><br><span class="line">frame_ms = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">self.frame_us = int(frame_ms * <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> channels &lt; <span class="number">1</span>:</span><br><span class="line">channels = <span class="number">1</span></span><br><span class="line"><span class="keyword">elif</span> channels &gt; (frame_ms // <span class="number">2</span>):</span><br><span class="line">channels = int(frame_ms // <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">self.channels = channels</span><br><span class="line"></span><br><span class="line">self._widths = [<span class="number">1000</span>] * channels <span class="comment"># set each channel to minimum pulse width</span></span><br><span class="line"></span><br><span class="line">self._wid = [<span class="keyword">None</span>]*self.WAVES</span><br><span class="line">self._next_wid = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">pi.write(gpio, pigpio.LOW)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_update</span><span class="params">(self)</span>:</span></span><br><span class="line">wf =[]</span><br><span class="line">micros = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> self._widths:</span><br><span class="line">wf.append(pigpio.pulse(<span class="number">0</span>, <span class="number">1</span>&lt;&lt;self.gpio, self.GAP))</span><br><span class="line">wf.append(pigpio.pulse(<span class="number">1</span>&lt;&lt;self.gpio, <span class="number">0</span>, i))</span><br><span class="line">micros += (i+self.GAP)</span><br><span class="line"><span class="comment">#micros += i</span></span><br><span class="line"><span class="comment"># off for the remaining frame period</span></span><br><span class="line">wf.append(pigpio.pulse(<span class="number">0</span>, <span class="number">1</span>&lt;&lt;self.gpio, self.frame_us-micros))</span><br><span class="line"></span><br><span class="line">self.pi.wave_add_generic(wf)</span><br><span class="line">wid = self.pi.wave_create()</span><br><span class="line">self.pi.wave_send_repeat(wid)</span><br><span class="line">self._wid[self._next_wid] = wid</span><br><span class="line"><span class="comment">#rint("create", self._next_wid, "with", wid)</span></span><br><span class="line"></span><br><span class="line">self._next_wid += <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> self._next_wid &gt;= self.WAVES:</span><br><span class="line">self._next_wid = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">wid = self._wid[self._next_wid]</span><br><span class="line"><span class="keyword">if</span> wid <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">print(<span class="string">"delete"</span>, self._next_wid, <span class="string">"with"</span>, wid)</span><br><span class="line">self.pi.wave_delete(wid)</span><br><span class="line">self._wid[self._next_wid] = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_channel</span><span class="params">(self, channel, width)</span>:</span></span><br><span class="line">self._widths[channel] = width</span><br><span class="line">self._update()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_channels</span><span class="params">(self, widths)</span>:</span></span><br><span class="line">self._widths[<span class="number">0</span>:len(widths)] = widths[<span class="number">0</span>:self.channels]</span><br><span class="line">self._update()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cancel</span><span class="params">(self)</span>:</span></span><br><span class="line">self.pi.wave_tx_stop()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> self._wid:</span><br><span class="line"><span class="keyword">if</span> i <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">self.pi.wave_delete(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> PPM</span><br><span class="line"><span class="keyword">import</span> pigpio</span><br><span class="line"></span><br><span class="line">pi = pigpio.pi(host=<span class="string">"192.168.2.117"</span>) <span class="comment">#change here with your own IP of raspberry pi.</span></span><br><span class="line">pi.wave_clear()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> pi.connected:</span><br><span class="line">exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">ppm = PPM.X(pi, <span class="number">14</span>)</span><br><span class="line"></span><br><span class="line">updates = <span class="number">0</span></span><br><span class="line">start = time.time()</span><br><span class="line"><span class="keyword">for</span> chan <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line"><span class="keyword">for</span> pw <span class="keyword">in</span> range(<span class="number">1000</span>, <span class="number">2000</span>, <span class="number">5</span>):</span><br><span class="line">ppm.update_channel(chan, pw)</span><br><span class="line">updates += <span class="number">1</span></span><br><span class="line">time.sleep(<span class="number">0.03</span>)</span><br><span class="line">end = time.time()</span><br><span class="line">secs = end - start</span><br><span class="line">print(<span class="string">"&#123;&#125; updates in &#123;:.1f&#125; seconds (&#123;&#125;/s)"</span>.format(updates, secs, int(updates/secs)))</span><br><span class="line"></span><br><span class="line">ppm.update_channels([<span class="number">1000</span>, <span class="number">2000</span>, <span class="number">1000</span>, <span class="number">2000</span>, <span class="number">1000</span>, <span class="number">2000</span>, <span class="number">1000</span>, <span class="number">2000</span>])</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">ppm.cancel()</span><br><span class="line"></span><br><span class="line">pi.stop()</span><br></pre></td></tr></table></figure>
<p>But first of all, you have to do the high point set up again for your RC car according to your instruction of ESC. Connect the GND and Signal wire to from the ESC to the GPIO of your raspberry pi. Just as an example, the steps for my ESC are:</p>
<ul>
<li>switch on transmitter -&gt; which means i will start using my python script to send the signal of 1.5ms high-level cycles.</li>
<li>switch on receiver</li>
<li>While holding down set button on ESC, check that LED flashes in the order RED-&gt;Green-&gt;Orange-&gt;RED</li>
<li>Release set button when LED lights up RED. LED will start to single flash Red.</li>
<li>Apply full throttle (here i will start using python to send the signal of 1ms high-level cycles) and press set button once,, if procedure has been performed correctly, LED will start to double flash.</li>
<li>Apply full brake (here I will start using python to send the signal with 2 ms high-level cycles) and press set button once. If procedure has been performed correctly, LED will turn off.</li>
</ul>
<p>So now the ESC has learned the maximal position (the length of high-level in a 20ms cycle) and you can use the script to control your motor. try the following script.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> PPM</span><br><span class="line"><span class="keyword">import</span> pigpio</span><br><span class="line"></span><br><span class="line">pi = pigpio.pi(host=<span class="string">"192.168.2.117"</span>)</span><br><span class="line">pi.wave_clear()</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> pi.connected:</span><br><span class="line">exit(<span class="number">0</span>)</span><br><span class="line">ppm = PPM.X(pi, <span class="number">14</span>)</span><br><span class="line">print(<span class="string">"Neutral for 5 seconds"</span>)</span><br><span class="line">ppm.update_channel(<span class="number">0</span>, <span class="number">1500</span>)</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">print(<span class="string">"accelerate pedal from 0% to 100%"</span>)</span><br><span class="line"><span class="keyword">for</span> pw <span class="keyword">in</span> range(<span class="number">1500</span>,<span class="number">1000</span>,<span class="number">-5</span>):</span><br><span class="line">ppm.update_channel(<span class="number">0</span>,pw)</span><br><span class="line">updates +=<span class="number">1</span></span><br><span class="line">time.sleep(<span class="number">0.03</span>)</span><br><span class="line">print(<span class="string">"decelerate from 100% to 20%"</span>)</span><br><span class="line"><span class="keyword">for</span> pw <span class="keyword">in</span> range(<span class="number">1000</span>,<span class="number">1400</span>,<span class="number">5</span>):</span><br><span class="line">ppm.update_channel(<span class="number">0</span>,pw)</span><br><span class="line">updates +=<span class="number">1</span></span><br><span class="line">time.sleep(<span class="number">0.03</span>)</span><br><span class="line">print(<span class="string">"brake from 20% to 0%"</span>)</span><br><span class="line">ppm.update_channel(<span class="number">0</span>,<span class="number">1700</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">print(<span class="string">"brake released, neutral for 5s"</span>)</span><br><span class="line">ppm.update_channel(<span class="number">0</span>, <span class="number">1500</span>)</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">print(<span class="string">"reverse to 100%"</span>)</span><br><span class="line">ppm.update_channel(<span class="number">0</span>,<span class="number">2000</span>)</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">print(<span class="string">"Neutral for 5 seconds, programm finished."</span>)</span><br><span class="line">ppm.update_channel(<span class="number">0</span>, <span class="number">1500</span>)</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">ppm.cancel()</span><br><span class="line">pi.stop()</span><br></pre></td></tr></table></figure>
<p>the motor will accelerate from 0% to 100% and decelerate from 100% to 20%, after that, the motor will be braked to stop immediately. after 5 seconds staying in neutral position, it will start to accelerate in the reverse direction form 0 to 100% and after that the motor will be stopped.  </p>
<p>It is the same to control the servo motor for steering. After this you can control your rc car with a computer. If you expose your PIGPIO port (default 8888) to internet, you can also control it via internet when you are not at home. What you need is to add a camera to it, so that you can see where you are going. With a combination with OpenCV and TensorFlow, your car can even recognise the environment and realise part of autonomous driving.</p>
<p>####Reference</p>
<ul>
<li><p><a href="https://www.raspberrypi.org/forums/viewtopic.php?t=66445&amp;start=100" target="_blank" rel="noopener">https://www.raspberrypi.org/forums/viewtopic.php?t=66445&amp;start=100</a></p>
</li>
<li><p><a href="https://gpiozero.readthedocs.io/en/stable/remote_gpio.html" target="_blank" rel="noopener">https://gpiozero.readthedocs.io/en/stable/remote_gpio.html</a></p>
</li>
<li><p><a href="https://en.wikipedia.org/wiki/Pulse-position_modulation" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Pulse-position_modulation</a></p>
</li>
<li><p><a href="http://abyz.me.uk/rpi/pigpio/index.html" target="_blank" rel="noopener">http://abyz.me.uk/rpi/pigpio/index.html</a></p>
</li>
</ul>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/raspberry-pi-PPM-RC-car-control-PWM/" rel="tag"># raspberry pi, PPM, RC car, control, PWM</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blog/2019/01/01/Github-Hexo-Mac博客部署指南/" rel="next" title="Github+Hexo+Mac 博客部署指南">
                <i class="fa fa-chevron-left"></i> Github+Hexo+Mac 博客部署指南
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Thingsjar</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">2</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                    <span class="site-state-item-count">1</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:thingsjar@gmail.com" title="E-Mail &rarr; mailto:thingsjar@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Thingsjar</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v6.7.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  

  
  <script src="/js/src/scrollspy.js?v=6.7.0"></script>
<script src="/js/src/post-details.js?v=6.7.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  



  








  
  
  
  
  <script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  <script>
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item) > -1;
    });
    new Valine({
      el: '#comments' ,
      verify: false,
      notify: false,
      appId: 'KKH83bXpcfeMBHaDSPTEg0UU-gzGzoHsz',
      appKey: 'X732Rn66D3o7ayrOSjHuuAFG',
      placeholder: 'Just go go',
      avatar: 'mm',
      meta:guest,
      pageSize: '10' || 10,
      visitor: false
    });
  </script>




  





  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
